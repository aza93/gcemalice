<?php
/**
 * Created by PhpStorm.
 * User: aboussadia
 * Date: 04/07/2018
 * Time: 16:20
 */

namespace ExploitBundle\Repository;

use ExploitBundle\Resources\config\Connexion;

class RequegceRepository{

    private $gceconnect;

    public function __construct($con = null)
    {
        $con = new Connexion();
        $this->gceconnect = $con;
    }

    /**
     * @param $cmd
     */
    public function updaterenvoicmd($cmd)
    {

       $gce =  $this->gceconnect->controle_file_gce();
        $update_revoiCmd = oci_parse($gce, "UPDATE eve SET indapr='N'                     
                                                                       where CODSOC = 1 and achvte='A' and typeve='CDE'
                                                                       and indapr ='O'
                                                                       and sigtie <> 'PF0'
                                                                       and NUMEVE = $cmd");

       $req =  oci_execute($update_revoiCmd, OCI_COMMIT_ON_SUCCESS);
        if (!$req) {
            $e = oci_error($update_revoiCmd);
            trigger_error(htmlentities($e['message']), E_USER_ERROR);
        }
//        oci_fetch_all($update_revoiCmd, $res_req, null, null, OCI_FETCHSTATEMENT_BY_ROW);
        oci_free_statement($update_revoiCmd);

    }

    /**
     * @param $numncf
     */
    public function supprimencf($numncf)
    {
        $gce_req =  $this->gceconnect->controle_file_gce();

        if(is_numeric($numncf)){
    //        dump("update evl set qteliv = 0 where codsoc=1 and achvte='A' and typeve='NCF' and numeve = '$numncf' ");die;
            $supp_ncf =  oci_parse($gce_req, "UPDATE evl SET qteliv = 0 where codsoc = 1 and achvte='A' and  typeve='NCF' and  numeve = $numncf");

            $req =  oci_execute($supp_ncf, OCI_COMMIT_ON_SUCCESS);
            if (!$req) {
                $e = oci_error($supp_ncf);
                trigger_error(htmlentities($e['message']), E_USER_ERROR);
            }
            oci_free_statement($supp_ncf);
        }
    }

    public function impressionetiquetmag($mag)
    {


            dump($mag);
    }




}